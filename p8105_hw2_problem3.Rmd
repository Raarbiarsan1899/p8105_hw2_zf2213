---
title: "P8105 Homework 2 Problem 3"
author: "Zanis Fang"
date: "9/26/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#install p8105.datasets if not
if (!"p8105.datasets" %in% installed.packages()) {
	devtools::install_github("p8105/p8105.datasets")
}

library(tidyverse)
```

### load data and data cleaning:

```{r loading_cleaning}
# make a copy of the data frame
brfss <- p8105.datasets::brfss_smart2010

# clean the data
brfss <- brfss %>% 
	# get Overall Health topic
	filter(Topic == "Overall Health") %>%
	# remove unwanted variables
	select(-Class, -Topic, -Question, -Sample_Size, -(Confidence_limit_Low:GeoLocation)) %>% 
  # make human readable table
	spread(key = Response, value = Data_value) %>% 
	# clean column name
	janitor::clean_names() %>% 
	# rearrange the columns, remove locationabbr, which is included in locationdesc
	select(year, locationdesc, excellent, very_good, good, fair, poor) %>%
	# seperate locationdesc into state and area (county and municipal)
	separate(locationdesc, c("state", "area"), sep = " - ")

# calculate the proportion of excellent and very good ones
# for each location total is roughly 100, to be simple
brfss <- mutate(brfss, prop_high = (excellent + very_good) / 100)

```

### Answer questions:

**How many unique locations are included in the dataset? Is every state represented? What state is observed the most?**

```{r count_state_represents}
# count the represents in each state
state_reps <- brfss %>% 
	            group_by(state) %>%
	            summarize(n()) %>%
	            rename("represents" = "n()")
```

There are `r nrow(distinct(brfss, state, area))` unique locations. There are `r nrow(distinct(brfss, state))` states, all states are represented. The state observed most is `r state_reps[which.max(state_reps$represents), 1]`.
</br>

**In 2002, what is the median of the “Excellent” response value?**
</br>
Median is `r median(brfss[which(brfss$year == 2002), ]$excellent, na.rm = TRUE)`.


**Make a histogram of “Excellent” response values in the year 2002.**

```{r histogram_excellent_2002, message = FALSE, warning = FALSE}
# making histogram of excellent in 2002
ggplot(brfss[which(brfss$year == 2002),], aes(x = excellent)) + geom_histogram()

```

**Make a scatterplot showing the proportion of “Excellent” response values in New York County and Queens County (both in NY State) in each year from 2002 to 2010.**

```{r scatterplot_excellent_NY_ny_qs}
# create a variable for plotting
brfss_ny_qs <- brfss %>% filter(state == "NY", area %in% c("New York County", "Queens County"))

# plot scatterplot of excellent in New York and Queens counties
ggplot(brfss_ny_qs, aes(x = year, y = excellent / 100, color = area)) + 
	geom_point() +
	ylab("proportion of excellent")

```
